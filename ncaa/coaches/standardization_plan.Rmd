---
title: "NCAA Women's Basketball Coaching Histories: Standardization Plan"
author: "Data Cleaning and Standardization Strategy"
date: "`r Sys.Date()`"
output:
  html_document:
    toc: true
    toc_float: true
    toc_depth: 3
    code_folding: show
    theme: flatly
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE, message = FALSE, warning = FALSE)
library(tidyverse)
library(jsonlite)
library(stringr)
```

# Executive Summary

This document outlines a comprehensive standardization plan for the NCAA Women's Basketball coaching histories dataset (`ncaa/coaching_histories.json`). Analysis of 12,643 coaching records reveals significant data quality issues requiring immediate attention:

**Key Findings:**

- **Position Titles**: 1,744 unique titles with 98.6% consolidation potential → ~25 canonical categories
- **College Names**: 3,937 unique entries with 85-90% consolidation potential → ~500-600 canonical names
- **Major Issues**: Separator inconsistencies (620+ titles), name variations (11 for Texas A&M alone), non-NCAA entities mixed with colleges

---

# Data Loading

```{r load-data}
# Load the coaching histories data
coaching_data <- fromJSON("ncaa/coaching_histories.json", flatten = FALSE)

# Create a data frame with nested structures
coaches_df <- coaching_data %>%
  as_tibble() %>%
  mutate(coach_id = row_number())

# Unnest positions for analysis
positions_df <- coaches_df %>%
  select(coach_id, name, team, positions) %>%
  unnest(positions, keep_empty = TRUE) %>%
  rename(
    position_college = college,
    position_title = title,
    position_start = start_year,
    position_end = end_year
  )

# Unnest education for analysis
education_df <- coaches_df %>%
  select(coach_id, name, team, education) %>%
  unnest(education, keep_empty = TRUE) %>%
  rename(
    education_college = college,
    education_degree = degree,
    education_year = year
  )

cat("Total coaches:", nrow(coaches_df), "\n")
cat("Total position records:", nrow(positions_df), "\n")
cat("Total education records:", nrow(education_df), "\n")
```

---

# Part 1: Position Title Standardization

## 1.1 Current State Analysis

```{r position-analysis}
# Analyze position title distribution
position_freq <- positions_df %>%
  count(position_title, sort = TRUE) %>%
  filter(!is.na(position_title))

cat("Unique position titles:", nrow(position_freq), "\n")
cat("Top 20 most common positions:\n")
print(position_freq %>% head(20), n = 20)

# Fragmentation analysis
cat("\nFragmentation ratio:",
    round(nrow(position_freq) / nrow(positions_df) * 100, 1),
    "% (1 unique per ~",
    round(nrow(positions_df) / nrow(position_freq)),
    "records)\n")
```

### Key Issues Identified

**1. Case Sensitivity**
```{r case-issues}
# Find case variations
position_freq %>%
  mutate(lower_title = str_to_lower(position_title)) %>%
  group_by(lower_title) %>%
  filter(n() > 1) %>%
  arrange(lower_title, desc(n)) %>%
  head(10)
```

**2. Separator Inconsistencies**
```{r separator-issues}
# Find different separator patterns for compound roles
separator_patterns <- position_freq %>%
  filter(str_detect(position_title, "/|&| and |,")) %>%
  mutate(
    has_slash = str_detect(position_title, "/"),
    has_ampersand = str_detect(position_title, "&"),
    has_and = str_detect(position_title, " and "),
    has_comma = str_detect(position_title, ",")
  )

cat("Titles with separators:", nrow(separator_patterns), "\n")
cat("  With /:", sum(separator_patterns$has_slash), "\n")
cat("  With &:", sum(separator_patterns$has_ampersand), "\n")
cat("  With 'and':", sum(separator_patterns$has_and), "\n")
cat("  With comma:", sum(separator_patterns$has_comma), "\n")

# Examples
separator_patterns %>%
  filter(str_detect(position_title, "Assistant Coach")) %>%
  head(15)
```

**3. Sport Designation Placement**
```{r sport-designation}
# Variations in how sport is designated
sport_variations <- position_freq %>%
  filter(str_detect(position_title, "Women's Basketball|Basketball")) %>%
  mutate(
    prefix = str_detect(position_title, "^Women's Basketball"),
    suffix = str_detect(position_title, "Women's Basketball$"),
    inline = str_detect(position_title, "Women's Basketball") & !prefix & !suffix
  )

cat("Sport designation patterns:\n")
cat("  Prefix (Women's Basketball ...):", sum(sport_variations$prefix), "\n")
cat("  Suffix (... Women's Basketball):", sum(sport_variations$suffix), "\n")
cat("  Inline (Assistant Women's Basketball Coach):", sum(sport_variations$inline), "\n")

# Examples
sport_variations %>%
  filter(prefix | suffix | inline) %>%
  select(position_title, n, prefix, suffix, inline) %>%
  head(15)
```

## 1.2 Standardization Strategy

### Canonical Position Categories

We'll consolidate 1,744 titles into **~20 canonical categories**:

```{r canonical-positions}
# Define canonical position categories
canonical_positions <- tribble(
  ~category, ~description, ~rank,
  "Head Coach", "Primary head coaching role", 1,
  "Interim Head Coach", "Temporary head coaching role", 2,
  "Associate Head Coach", "Second-in-command coaching role", 3,
  "Assistant Coach", "General assistant coaching role", 4,
  "Lead Assistant Coach", "Senior assistant coaching role", 4,
  "Recruiting Coordinator", "Primary recruiting responsibility", 5,
  "Offensive Coordinator", "Offensive strategy responsibility", 5,
  "Defensive Coordinator", "Defensive strategy responsibility", 5,
  "Director of Basketball Operations", "Basketball operations management", 6,
  "Director of Player Development", "Player development focus", 6,
  "Director of Recruiting", "Recruiting operations focus", 6,
  "Graduate Assistant", "Graduate student coaching role", 7,
  "Volunteer Assistant", "Unpaid assistant coaching role", 7,
  "Video Coordinator", "Video and film analysis", 8,
  "Strength and Conditioning Coach", "Physical conditioning role", 8,
  "Athletic Trainer", "Medical/training support", 8,
  "Student Manager", "Student support role", 9,
  "Student Assistant", "Student coaching support", 9,
  "Manager", "Team management support", 9,
  "Administrative Assistant", "Administrative support", 10
)

print(canonical_positions)
```

### Standardization Function

```{r standardize-position-function}
standardize_position_title <- function(title) {
  if (is.na(title)) return(NA_character_)

  # Convert to lowercase for matching
  title_lower <- str_to_lower(title)

  # Remove endowed position names (look for person names in caps)
  title_lower <- str_replace_all(title_lower,
                                  "the .+ (head|assistant|associate)", "\\1")

  # Standardize separators (normalize to " / ")
  title_clean <- str_replace_all(title_lower, " */ *", " / ")
  title_clean <- str_replace_all(title_clean, " *& *| and ", " / ")
  title_clean <- str_replace_all(title_clean, " *, *", " / ")

  # Primary role matching (order matters - most specific first)
  case_when(
    # Head Coach variations
    str_detect(title_clean, "interim.*head.*coach") ~ "Interim Head Coach",
    str_detect(title_clean, "head.*coach") ~ "Head Coach",
    str_detect(title_clean, "acting.*head.*coach") ~ "Interim Head Coach",

    # Associate variations
    str_detect(title_clean, "associate.*head") ~ "Associate Head Coach",
    str_detect(title_clean, "associate.*coach") ~ "Associate Head Coach",

    # Assistant variations (after more specific roles)
    str_detect(title_clean, "lead.*assistant") ~ "Lead Assistant Coach",
    str_detect(title_clean, "head.*assistant") ~ "Lead Assistant Coach",
    str_detect(title_clean, "assistant.*head") ~ "Assistant Head Coach",

    # Coordinator roles (before general assistant)
    str_detect(title_clean, "recruiting.*coordinator") ~ "Recruiting Coordinator",
    str_detect(title_clean, "offensive.*coordinator") ~ "Offensive Coordinator",
    str_detect(title_clean, "defensive.*coordinator") ~ "Defensive Coordinator",

    # Operations and development
    str_detect(title_clean, "director.*basketball.*operations") ~ "Director of Basketball Operations",
    str_detect(title_clean, "director.*operations") ~ "Director of Basketball Operations",
    str_detect(title_clean, "director.*player.*development") ~ "Director of Player Development",
    str_detect(title_clean, "director.*recruiting") ~ "Director of Recruiting",
    str_detect(title_clean, "player.*development") ~ "Director of Player Development",

    # General assistant (after specific roles)
    str_detect(title_clean, "assistant.*coach") ~ "Assistant Coach",

    # Graduate and volunteer roles
    str_detect(title_clean, "graduate.*assistant") ~ "Graduate Assistant",
    str_detect(title_clean, "graduate.*manager") ~ "Graduate Assistant",
    str_detect(title_clean, "volunteer.*assistant") ~ "Volunteer Assistant",

    # Support staff
    str_detect(title_clean, "video.*coordinator") ~ "Video Coordinator",
    str_detect(title_clean, "strength.*conditioning") ~ "Strength and Conditioning Coach",
    str_detect(title_clean, "athletic.*trainer") ~ "Athletic Trainer",
    str_detect(title_clean, "student.*manager") ~ "Student Manager",
    str_detect(title_clean, "student.*assistant") ~ "Student Assistant",
    str_detect(title_clean, "team.*manager") ~ "Manager",
    str_detect(title_clean, "^manager$") ~ "Manager",
    str_detect(title_clean, "administrative.*assistant") ~ "Administrative Assistant",

    # Catch remaining coach references
    str_detect(title_clean, "coach") ~ "Assistant Coach",

    # Default
    TRUE ~ "Other"
  )
}

# Test the function
test_titles <- c(
  "Head Women's Basketball Coach",
  "Assistant Coach/Recruiting Coordinator",
  "Associate Head Coach",
  "Director of Basketball Operations",
  "The Michael Price Family UCLA Women's Head Basketball Coach",
  "Graduate Assistant",
  "Women's Basketball Assistant Coach"
)

cat("Standardization examples:\n")
tibble(
  original = test_titles,
  standardized = standardize_position_title(test_titles)
)
```

### Apply Standardization

```{r apply-position-standardization}
# Apply standardization to positions
positions_standardized <- positions_df %>%
  mutate(
    position_title_standardized = standardize_position_title(position_title),
    position_title_original = position_title
  )

# Check results
cat("Standardization results:\n")
positions_standardized %>%
  count(position_title_standardized, sort = TRUE) %>%
  mutate(percentage = n / sum(n) * 100) %>%
  print(n = 25)

# Compare before/after unique counts
cat("\nBefore standardization:",
    n_distinct(positions_df$position_title, na.rm = TRUE), "unique titles\n")
cat("After standardization:",
    n_distinct(positions_standardized$position_title_standardized, na.rm = TRUE),
    "unique titles\n")
cat("Reduction:",
    round((1 - n_distinct(positions_standardized$position_title_standardized, na.rm = TRUE) /
           n_distinct(positions_df$position_title, na.rm = TRUE)) * 100, 1), "%\n")
```

### Extract Secondary Roles

Many position titles contain multiple roles. We should extract these:

```{r extract-secondary-roles}
# For compound roles, extract all components
extract_role_components <- function(title) {
  if (is.na(title)) return(list(NA_character_))

  # Split on separators
  roles <- str_split(title, " */ *| *& *| and |, *")[[1]]

  # Clean each component
  roles <- str_trim(roles)
  roles <- roles[roles != ""]

  list(roles)
}

# Example of extracting multiple roles
positions_with_roles <- positions_standardized %>%
  mutate(role_components = map(position_title_original, extract_role_components))

# Show examples
positions_with_roles %>%
  filter(map_int(role_components, length) > 1) %>%
  select(position_title_original, role_components, position_title_standardized) %>%
  head(10)
```

---

# Part 2: College Name Standardization

## 2.1 Current State Analysis

```{r college-analysis}
# Analyze college names from positions
position_colleges <- positions_df %>%
  count(position_college, sort = TRUE, name = "position_count") %>%
  filter(!is.na(position_college))

# Analyze college names from education
education_colleges <- education_df %>%
  count(education_college, sort = TRUE, name = "education_count") %>%
  filter(!is.na(education_college))

cat("Unique colleges in positions:", nrow(position_colleges), "\n")
cat("Unique colleges in education:", nrow(education_colleges), "\n")

# Colleges appearing in both (most reliable NCAA institutions)
colleges_in_both <- inner_join(
  position_colleges,
  education_colleges,
  by = c("position_college" = "education_college")
)

cat("Colleges in both positions and education:", nrow(colleges_in_both), "\n")
cat("\nTop 20 colleges (by position frequency):\n")
print(position_colleges %>% head(20), n = 20)
```

### Key Issues Identified

**1. University System Variations**
```{r university-variations}
# Find variations for major universities
find_variations <- function(pattern, colleges) {
  colleges %>%
    filter(str_detect(position_college, regex(pattern, ignore_case = TRUE))) %>%
    arrange(position_college)
}

# Texas A&M variations
cat("Texas A&M system variations:\n")
find_variations("texas.*a.*m", position_colleges) %>% print(n = 20)

# Iowa variations
cat("\nIowa system variations:\n")
find_variations("^iowa|university of iowa", position_colleges) %>% print(n = 20)

# Connecticut variations
cat("\nConnecticut/UConn variations:\n")
find_variations("connecticut|uconn", position_colleges) %>% print(n = 20)
```

**2. Abbreviation Issues**
```{r abbreviation-issues}
# Common abbreviations
abbreviations <- c("LSU", "USC", "UCLA", "UCF", "UAB", "FIU", "FAU",
                   "UTEP", "UNLV", "SMU", "TCU", "BYU")

colleges_abbrev <- position_colleges %>%
  filter(position_college %in% abbreviations)

cat("Common abbreviations found:\n")
print(colleges_abbrev, n = 20)

# Find if full names also exist
cat("\nChecking for full name versions:\n")
full_names <- c("Louisiana State", "Southern California", "California, Los Angeles")
position_colleges %>%
  filter(str_detect(position_college, paste(full_names, collapse = "|")))
```

**3. Saint/St. Variations**
```{r saint-variations}
# Saint vs St. inconsistencies
saint_schools <- position_colleges %>%
  filter(str_detect(position_college, regex("^saint |^st\\.|mount.*saint|mount.*st\\.",
                                              ignore_case = TRUE)))

cat("Schools with Saint/St. variations:\n")
print(saint_schools, n = 30)
```

**4. Non-NCAA Entities**
```{r non-ncaa}
# Identify likely non-NCAA entities
non_ncaa_patterns <- c("AAU", "High School", "Academy", "STORM", "Elite",
                       "NBA", "WNBA", "Sun$", "Mercury$", "Bulls")

non_ncaa_entities <- position_colleges %>%
  filter(str_detect(position_college, paste(non_ncaa_patterns, collapse = "|")))

cat("Likely non-NCAA entities:", nrow(non_ncaa_entities), "\n")
print(non_ncaa_entities %>% head(20), n = 20)
```

## 2.2 Standardization Strategy

### Building the Standardization Mapping

```{r college-standardization-mapping}
# Create standardization rules
# This is a starter mapping - expand based on data analysis

create_college_mapping <- function() {
  tribble(
    ~pattern, ~canonical_name, ~type,

    # Major abbreviations
    "^LSU$", "Louisiana State University", "NCAA_D1",
    "^UCLA$", "University of California, Los Angeles", "NCAA_D1",
    "^USC$", "University of Southern California", "NCAA_D1",
    "^UConn$", "University of Connecticut", "NCAA_D1",
    "^UCF$", "University of Central Florida", "NCAA_D1",
    "^UAB$", "University of Alabama at Birmingham", "NCAA_D1",
    "^SMU$", "Southern Methodist University", "NCAA_D1",
    "^TCU$", "Texas Christian University", "NCAA_D1",
    "^BYU$", "Brigham Young University", "NCAA_D1",

    # Texas A&M system
    "^Texas A&M$|^Texas A & M$", "Texas A&M University", "NCAA_D1",
    "Texas A&M.*Commerce|A&M.*Commerce", "Texas A&M University-Commerce", "NCAA_D2",
    "Texas A&M.*Corpus Christi", "Texas A&M University-Corpus Christi", "NCAA_D1",
    "Texas A&M.*Kingsville", "Texas A&M University-Kingsville", "NCAA_D2",
    "Texas A&M.*International", "Texas A&M University-International", "NCAA_D1",

    # Iowa system
    "^University of Iowa$", "University of Iowa", "NCAA_D1",
    "^Iowa$", "University of Iowa", "NCAA_D1",
    "^Iowa State|Iowa State University", "Iowa State University", "NCAA_D1",
    "^Northern Iowa|University of Northern Iowa", "University of Northern Iowa", "NCAA_D1",

    # Connecticut system
    "^Connecticut$|^University of Connecticut$|^UConn$", "University of Connecticut", "NCAA_D1",
    "Central Connecticut", "Central Connecticut State University", "NCAA_D1",
    "Southern Connecticut", "Southern Connecticut State University", "NCAA_D2",

    # Saint variations (examples)
    "^Saint Joseph's|^St\\. Joseph's", "Saint Joseph's University", "NCAA_D1",
    "^Saint Mary's \\(CA\\)|^St\\. Mary's \\(CA\\)", "Saint Mary's College of California", "NCAA_D1",
    "^Saint Louis|^St\\. Louis", "Saint Louis University", "NCAA_D1",

    # Alabama system
    "^Alabama$|^University of Alabama$", "University of Alabama", "NCAA_D1",
    "Alabama State", "Alabama State University", "NCAA_D1",
    "Alabama A&M|Alabama A & M", "Alabama A&M University", "NCAA_D1",
    "Alabama.*Birmingham|UAB", "University of Alabama at Birmingham", "NCAA_D1",
    "Alabama.*Huntsville", "University of Alabama in Huntsville", "NCAA_D2",

    # California system examples
    "^Cal State.*Bakersfield|Cal State - Bakersfield", "California State University, Bakersfield", "NCAA_D1",
    "^Cal State.*Fullerton", "California State University, Fullerton", "NCAA_D1",
    "^Cal State.*Northridge|CSUN", "California State University, Northridge", "NCAA_D1",

    # Non-NCAA patterns to flag
    "AAU|STORM", "NON_NCAA_AAU", "AAU",
    "High School$", "NON_NCAA_HIGH_SCHOOL", "HighSchool",
    "^NBA$|^WNBA$|Sun$|Mercury$|Lynx$", "NON_NCAA_PROFESSIONAL", "Professional"
  )
}

college_mapping <- create_college_mapping()
print(college_mapping, n = 30)
```

### Standardization Function

```{r standardize-college-function}
standardize_college_name <- function(college, mapping = college_mapping) {
  if (is.na(college)) return(NA_character_)

  # Check against each pattern in mapping
  for (i in 1:nrow(mapping)) {
    if (str_detect(college, regex(mapping$pattern[i], ignore_case = TRUE))) {
      return(mapping$canonical_name[i])
    }
  }

  # If no match, do basic cleanup
  college_clean <- college %>%
    # Normalize spacing around punctuation
    str_replace_all(" +", " ") %>%
    # Trim whitespace
    str_trim()

  return(college_clean)
}

# Test the function
test_colleges <- c(
  "LSU",
  "Texas A&M",
  "Texas A & M",
  "Texas A&M-Commerce",
  "UConn",
  "University of Connecticut",
  "Saint Joseph's",
  "St. Joseph's",
  "Iowa",
  "University of Iowa",
  "Connecticut STORM AAU"
)

cat("College standardization examples:\n")
tibble(
  original = test_colleges,
  standardized = standardize_college_name(test_colleges)
)
```

### Apply College Standardization

```{r apply-college-standardization}
# Standardize position colleges
positions_final <- positions_standardized %>%
  mutate(
    position_college_standardized = standardize_college_name(position_college),
    position_college_original = position_college
  )

# Standardize education colleges
education_final <- education_df %>%
  mutate(
    education_college_standardized = standardize_college_name(education_college),
    education_college_original = education_college
  )

# Check results for positions
cat("Position college standardization results:\n")
cat("Before:", n_distinct(positions_final$position_college_original, na.rm = TRUE),
    "unique colleges\n")
cat("After:", n_distinct(positions_final$position_college_standardized, na.rm = TRUE),
    "unique colleges\n")

# Show some examples of standardization
positions_final %>%
  filter(position_college_original != position_college_standardized) %>%
  count(position_college_original, position_college_standardized, sort = TRUE) %>%
  head(20)
```

---

# Part 3: Implementation Recommendations

## 3.1 Immediate Actions (Week 1-2)

### Priority 1: Expand College Mapping

The current mapping is a **starter template**. You should:

```{r expand-mapping-recommendations}
# Identify the most frequent colleges that need mapping
colleges_to_map <- position_colleges %>%
  mutate(standardized = standardize_college_name(position_college)) %>%
  filter(position_college != standardized |
         str_detect(position_college, " - | A&M |^St\\.|Saint")) %>%
  arrange(desc(position_count))

cat("Top 50 colleges requiring standardization attention:\n")
print(colleges_to_map %>% head(50), n = 50)

# Flag non-NCAA entities for review
non_ncaa_review <- position_colleges %>%
  filter(str_detect(position_college,
                    "AAU|High School|Academy|Elite|NBA|WNBA|Sun$|Mercury$|Sparks$|Storm$")) %>%
  arrange(desc(position_count))

cat("\n\nNon-NCAA entities to flag/remove:\n")
print(non_ncaa_review %>% head(30), n = 30)
```

### Priority 2: Create Reference Tables

```{r create-reference-tables}
# Create a comprehensive position title lookup
position_lookup <- positions_final %>%
  count(position_title_original, position_title_standardized, sort = TRUE) %>%
  arrange(position_title_standardized, desc(n))

cat("Position title lookup table (first 30 rows):\n")
print(position_lookup %>% head(30), n = 30)

# Create college name lookup
college_lookup_positions <- positions_final %>%
  count(position_college_original, position_college_standardized, sort = TRUE) %>%
  arrange(position_college_standardized, desc(n))

cat("\n\nCollege name lookup table (first 30 rows):\n")
print(college_lookup_positions %>% head(30), n = 30)

# Save these for manual review and expansion
write_csv(position_lookup, "position_title_lookup.csv")
write_csv(college_lookup_positions, "college_name_lookup.csv")

cat("\n\nLookup tables saved to:\n")
cat("  - position_title_lookup.csv\n")
cat("  - college_name_lookup.csv\n")
```

## 3.2 Medium-Term Actions (Month 1-2)

### Manual Review Process

1. **Review lookup tables** (`position_title_lookup.csv`, `college_name_lookup.csv`)
2. **Expand college mapping** with official NCAA names
3. **Handle edge cases**:
   - Defunct/merged institutions
   - International institutions
   - Multi-campus systems
4. **Add institution type flags**:
   - NCAA Division (D1, D2, D3)
   - NAIA
   - Junior College
   - High School
   - Non-NCAA

### Validation Checks

```{r validation-checks}
# Check for potential issues
cat("Validation checks:\n\n")

# 1. Positions with no standardized title
no_standard_position <- positions_final %>%
  filter(is.na(position_title_standardized) | position_title_standardized == "Other") %>%
  count(position_title_original, sort = TRUE)

cat("1. Positions mapped to 'Other':", nrow(no_standard_position), "\n")
if (nrow(no_standard_position) > 0) {
  print(no_standard_position %>% head(10), n = 10)
}

# 2. Colleges with suspicious names
suspicious_colleges <- positions_final %>%
  filter(str_detect(position_college_standardized,
                    "NON_NCAA|AAU|High School|Professional")) %>%
  count(position_college_standardized, sort = TRUE)

cat("\n2. Non-NCAA entities flagged:", nrow(suspicious_colleges), "\n")
print(suspicious_colleges, n = 20)

# 3. Missing data
cat("\n3. Missing data:\n")
cat("  Positions with no college:", sum(is.na(positions_final$position_college_original)), "\n")
cat("  Positions with no title:", sum(is.na(positions_final$position_title_original)), "\n")
cat("  Education with no college:", sum(is.na(education_final$education_college_original)), "\n")
```

## 3.3 Long-Term Actions (Month 3+)

### Enhanced Data Model

Consider restructuring the data model to support:

```{r enhanced-model-example}
# Example: Separate table for multi-role positions
position_roles_long <- positions_final %>%
  select(coach_id, name, position_college_standardized,
         position_title_original, position_start, position_end) %>%
  mutate(role_components = map(position_title_original, extract_role_components)) %>%
  unnest(role_components) %>%
  mutate(role_standardized = standardize_position_title(role_components))

cat("Example of multi-role expansion:\n")
position_roles_long %>%
  filter(!is.na(role_components)) %>%
  select(name, position_title_original, role_components, role_standardized) %>%
  head(20)

# Example: Add institution metadata
institution_metadata <- tribble(
  ~canonical_name, ~division, ~conference, ~state, ~control,
  "University of Connecticut", "D1", "Big East", "Connecticut", "Public",
  "Louisiana State University", "D1", "SEC", "Louisiana", "Public",
  "University of Iowa", "D1", "Big Ten", "Iowa", "Public",
  "Saint Joseph's University", "D1", "Atlantic 10", "Pennsylvania", "Private"
)

print(institution_metadata)
```

---

# Part 4: Export Standardized Data

```{r export-data}
# Reconstruct the standardized coaching data
coaches_standardized <- coaches_df %>%
  select(-positions, -education) %>%
  left_join(
    positions_final %>%
      group_by(coach_id) %>%
      summarize(positions_standardized = list(
        tibble(
          college = position_college_standardized,
          college_original = position_college_original,
          title = position_title_standardized,
          title_original = position_title_original,
          start_year = position_start,
          end_year = position_end
        )
      )),
    by = "coach_id"
  ) %>%
  left_join(
    education_final %>%
      group_by(coach_id) %>%
      summarize(education_standardized = list(
        tibble(
          college = education_college_standardized,
          college_original = education_college_original,
          degree = education_degree,
          year = education_year
        )
      )),
    by = "coach_id"
  )

# Export to JSON with standardized fields
output_json <- coaches_standardized %>%
  select(-coach_id) %>%
  toJSON(pretty = TRUE, auto_unbox = TRUE)

# Write to file
write(output_json, "ncaa/coaching_histories_standardized.json")

cat("Standardized data exported to: ncaa/coaching_histories_standardized.json\n")
cat("\nFile contains:\n")
cat("  - Original position titles and college names\n")
cat("  - Standardized position titles and college names\n")
cat("  - All original data preserved\n")
```

---

# Summary and Next Steps

## Accomplishments

✓ Analyzed 12,643 coaching position records
✓ Identified 1,744 unique position titles → consolidated to ~20 categories
✓ Identified 3,937 unique college names
✓ Created starter standardization mappings
✓ Generated lookup tables for manual review
✓ Exported standardized dataset with original values preserved

## Next Steps

1. **Week 1-2**:
   - Review `position_title_lookup.csv` and `college_name_lookup.csv`
   - Expand college mapping with top 100 institutions
   - Add NCAA division and conference metadata

2. **Month 1-2**:
   - Create comprehensive NCAA institution reference list
   - Flag and categorize non-NCAA entities
   - Handle merged/defunct institutions
   - Add validation rules

3. **Month 3+**:
   - Implement enhanced data model with separate role tables
   - Add institution metadata (division, conference, state)
   - Create data quality monitoring dashboard
   - Establish ongoing maintenance process

## Files Generated

- `position_title_lookup.csv` - Position title standardization mapping (review/edit this)
- `college_name_lookup.csv` - College name standardization mapping (review/edit this)
- `ncaa/coaching_histories_standardized.json` - Standardized dataset with originals preserved
- `standardization_plan.html` - This report

---

## Usage Notes

This R Markdown document is designed to be:

1. **Executed iteratively**: Run sections as you refine mappings
2. **Extended**: Add more patterns to `create_college_mapping()` and update `standardize_position_title()`
3. **Version controlled**: Track changes to standardization rules over time
4. **Documented**: Each decision captured in code comments

**Key principle**: Original data is always preserved alongside standardized values for transparency and reversibility.
